/**
 *
 * Created by OAKutsenko on 24.10.2017.
 */
$(document).ready(function(){"use strict";var requestMode,formValue,responseFunction=function(e,t,a){var r=a.getResponseHeader("content-type")||"";if(r.indexOf("html")>-1)"send"==requestMode&&($("body").html(e),$("form").submit());else if(r.indexOf("json")>-1)switch(requestMode){case"fee":toggleSubmitButton("span.toggleButton"),formValue=addData(e),$("#bank").html(e.bank),$("#amount").html(e.amount),$("#total").html(e.total),$("#feeValue").html(e.fee),$("#sum_i").hide(),$("#sum_v").show()}};function addData(e){if(e.rid)return formValue.replace("}",',"rid":"'+e.rid+'", "fee":"'+e.fee+'"}')}var showErrorView=function(xhr,ajaxOptions,thrownError){var ct=xhr.getResponseHeader("content-type")||"";if(ct.indexOf("html")>-1)$("html").html(xhr.responseText);else if(ct.indexOf("json")>-1){var err=eval("("+xhr.responseText+")");$("#result").removeClass("hidden"),$("#invoice").addClass("hidden"),$("#errorHeader").removeClass("hidden"),$("#title").html(xhr?xhr.status>0?xhr.status:522:"400"),err.message?$("#msg").html(err.message):thrownError&&$("#msg").html(thrownError)}};function ajaxReq(e,t){$.ajax({url:window.location.origin+window.location.pathname+"/"+e,type:"POST",data:t,async:!0,beforeSend:function(e){e.setRequestHeader("Accept","application/json"),e.setRequestHeader("Content-Type","application/json"),$("input").prop("disabled",!0),$("button").prop("disabled",!0),$("#loader").show()},complete:function(){$("#loader").delay(100).slideUp(100),$("button").prop("disabled",!1)},success:responseFunction,error:showErrorView})}function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}function toggleSubmitButton(e){$(e).find("button").each(function(e){$(this).hasClass("hidden")?$(this).removeClass("hidden"):$(this).addClass("hidden")})}function getFormData(e){var t={};return $.each($(e).find("input:not(:checkbox)").serializeArray(),function(e,a){t.hasOwnProperty(a.name)?(t[a.name]=$.makeArray(t[a.name]),t[a.name].push(a.value.replace(/[/-]/g,""))):t[a.name]=a.value.replace(/[/-]/g,"")}),t.text=getParameterByName("text"),JSON.stringify(t)}function setFormValidation(e){$(e).validate({rules:{pan:{required:!0,creditcard:!0,minlength:19},sum:{required:!0,min:100},cvv:{required:!0,minlength:3},expDate:{required:!0,minlength:5,dataOld:!0},agree:{required:!0,agreeCheck:!0}},errorPlacement:function(e,t){$(t).parent("div").addClass("has-error"),$(t).is(":checkbox")&&$("#agree").css("color","#f44336")},submitHandler:function(e){switch(findPressedButton(e),requestMode){case"fee":formValue=getFormData(e),ajaxReq(requestMode,formValue);break;default:ajaxReq(requestMode,formValue)}}})}function findPressedButton(e){$(e).find('button[type="submit"]').each(function(e){$(this).hasClass("hidden")||(requestMode=this.id)})}function expDateValidate(e){var t=new Date,a=t.getUTCFullYear(),r=("0"+(t.getUTCMonth()+1)).slice(-2);return e.replace(/(\d{2})\/(\d{2})/,"20$2$1")>=a+""+r}$("input[type=checkbox]").click(function(){1==$(this).prop("checked")?$("#agree").removeAttr("style"):$("#agree").css("color","#f44336")}),setFormValidation("#InvoiceAccept"),$("#pan").mask("M000-0000-0000-0000",{translation:{M:{pattern:/[2,4,5]/,optional:!1}}}),$("#cvv").mask("000"),$("#suminp").mask("0####.00",{reverse:!0,onChange:function(e){$("#suminp").val(e.replace(/^0/,""))}}),$("#expDate").mask("M0/Y0",{translation:{M:{pattern:/[0,1]/,optional:!1},m:{pattern:/[1-9]/,optional:!1},s:{pattern:/[0,1,2]/,optional:!1},Y:{pattern:/[1-2]/,optional:!1}},onKeyPress:function(e,t,a,r){var n="Mm/Y0";(1==e||e>9)&&(n="Ms/Y0"),$("#expDate").mask(n,r)}}),$.validator.addMethod("dataOld",function(e,t){return!!this.optional(t)||expDateValidate(e)},"Invalid data is old."),$.validator.addMethod("agreeCheck",function(e,t){return!!t.checked&&($(t).closest("div").removeClass("has-error"),!0)},"Please accept our policy.")});